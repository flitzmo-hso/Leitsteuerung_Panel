{"ast":null,"code":"var _jsxFileName = \"/home/flitzmofinal/GitHub/Leitsteuerung_Panel/src/components/Orders.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect } from \"react\";\nimport TabChange from './Orders/TabChange.js';\nimport axios from \"axios\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function Orders() {\n  _s();\n\n  const [allData, setAllData] = useState([]);\n  const lst = [];\n\n  const populateData = data => {\n    lst.push(data);\n  };\n\n  useEffect(() => {\n    const interval = setInterval(() => {\n      getTaskStates();\n    }, 2000);\n    return () => clearInterval(interval);\n  }, []);\n\n  function getTaskStates() {\n    getSessionId();\n    axios.get('http://0.0.0.0:8080/task_list').then(res => {\n      console.log(\"Tasks:\", res.data); //Data from Gateway\n\n      if (res.data.length === 0) {\n        //Check if data is available\n        return;\n      }\n\n      var newData = [];\n      res.data.forEach(element => {\n        //Convert response to right format\n        newData.push(element);\n      });\n      if (DataAreEqual(allData, newData)) return; //Check if data has changed   \n\n      updateOrderStatus(allData, newData); //Update Status of new orders\n\n      setAllData(newData); //Set new Data\n    }).catch(err => {\n      console.log(err.message); //Error-Handling\n    });\n  }\n\n  function sleep(ms) {\n    return new Promise(resolve => setTimeout(resolve, ms));\n  }\n\n  function axiosTest(populateData) {\n    axios.get(\"http://0.0.0.0:8080/getSessionId\").then(function (response) {\n      populateData(response.data);\n    }).catch(function (error) {\n      console.log(error);\n    });\n  }\n\n  function updateOrderStatus(oldData, newData) {\n    //TODO : Hier in Zukunft nur die neuen Änderungen. Dazu OldData mit NewData vergleichen.\n    //Aktuell werden noch alle genommen.\n    var s_id = axiosTest();\n    sleep(1500).then(() => {\n      console.log(\"S_ID:\", s_id);\n      newData.forEach(element => {\n        var statusNr; //STATUS Überprüfen, ob sie passen -> Pending ?! \n\n        if (element['state'] === \"Pending\") statusNr = 1; //open\n        else if (element['state'] === \"Active/Executing\") statusNr = 2; //in progress\n          else if (element['state'] === \"Completed\") statusNr = 3; // Finished\n            else if (element['state'] === \"Active/Cancelled\") statusNr = 4; //canceled\n              else if (element['state'] === \"Queued\") statusNr = 5; //waiting\n                else if (element['state'] === \"Failed\") statusNr = 6; //Fehler\n\n        console.log(\"SessionID vor dem verschicken\", s_id);\n        var obj = {\n          \"status\": statusNr,\n          \"session_id\": s_id,\n          \"task_id\": element[\"task_id\"]\n        };\n        console.log(\"PUT OBJ:\", obj);\n        axios.put('http://0.0.0.0:8080/updateOrderStatus', obj).then(res => {\n          if (res.data === undefined || res.data.length === 0) return;\n          console.log(\"Response:\", res.data);\n        }).catch(err => {\n          console.log(err.message); //Error-Handling\n\n          alert(\"Fehler beim Auftrag übermitteln.\");\n        });\n      });\n    });\n  } //Check if old data = new data\n\n\n  function DataAreEqual(inputData, sortedOrders) {\n    if (inputData.sort().join(',') === sortedOrders.sort().join(',')) {\n      return true;\n    } else return false;\n  }\n\n  function getSessionId() {\n    axios.get('http://0.0.0.0:8080/getSessionId').then(res => {\n      console.log(\"SessionId:\", res.data); //Data from Gateway\n\n      if (res.data.length === 0) {\n        //Check if data is available\n        return;\n      }\n\n      return String(res.data);\n    }).catch(err => {\n      console.log(err.message); //Error-Handling\n    });\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: /*#__PURE__*/_jsxDEV(TabChange, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 149,\n      columnNumber: 10\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 148,\n    columnNumber: 9\n  }, this);\n}\n\n_s(Orders, \"wvSF2ckxQjUNASfZMrdtN9Q7fbY=\");\n\n_c = Orders;\n\nvar _c;\n\n$RefreshReg$(_c, \"Orders\");","map":{"version":3,"sources":["/home/flitzmofinal/GitHub/Leitsteuerung_Panel/src/components/Orders.js"],"names":["React","useState","useEffect","TabChange","axios","Orders","allData","setAllData","lst","populateData","data","push","interval","setInterval","getTaskStates","clearInterval","getSessionId","get","then","res","console","log","length","newData","forEach","element","DataAreEqual","updateOrderStatus","catch","err","message","sleep","ms","Promise","resolve","setTimeout","axiosTest","response","error","oldData","s_id","statusNr","obj","put","undefined","alert","inputData","sortedOrders","sort","join","String"],"mappings":"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","sourcesContent":["import React, { useState, useEffect} from \"react\";\nimport TabChange from './Orders/TabChange.js';\nimport axios from \"axios\";\n \n\nexport default function Orders() {\n\nconst [allData, setAllData] = useState([]);\nconst lst = [];  \nconst populateData = (data) => {lst.push(data)} \n\nuseEffect(() => {\n   \n\n    const interval = setInterval(() => { getTaskStates() }, 2000)\n    return ()=> clearInterval(interval)\n  }, []);\n  \n\nfunction getTaskStates(){\n\n    getSessionId();\n\n    axios.get('http://0.0.0.0:8080/task_list')\n    .then(res => {\n    console.log(\"Tasks:\", res.data); //Data from Gateway\n\n    if(res.data.length === 0) { //Check if data is available\n     \n      return;\n    }\n\n    var newData = [];\n\n    res.data.forEach(element => { //Convert response to right format\n        newData.push(element)\n    });\n\n    if (DataAreEqual(allData, newData)) return; //Check if data has changed   \n\n    updateOrderStatus(allData, newData); //Update Status of new orders\n\n    setAllData(newData); //Set new Data\n\n\n    })\n    .catch(err => {\n        console.log(err.message); //Error-Handling\n    })\n\n}\n\nfunction sleep(ms) {\n  return new Promise(resolve => setTimeout(resolve, ms));\n}\n\nfunction axiosTest (populateData) {\n  axios.get(\"http://0.0.0.0:8080/getSessionId\")\n .then(function(response){\n         populateData(response.data);\n  })\n  .catch(function(error){\n         console.log(error);\n   });\n}   \n\n\n  function updateOrderStatus(oldData, newData){  \n\n    //TODO : Hier in Zukunft nur die neuen Änderungen. Dazu OldData mit NewData vergleichen.\n    //Aktuell werden noch alle genommen.\n\n    var s_id = axiosTest();\n\n    sleep(1500).then(() => { \n\n      console.log(\"S_ID:\", s_id);\n\n    newData.forEach(element => {\n\n        var statusNr;\n\n        //STATUS Überprüfen, ob sie passen -> Pending ?! \n        if(element['state'] === \"Pending\") statusNr = 1; //open\n        else if(element['state'] === \"Active/Executing\") statusNr = 2; //in progress\n        else if(element['state'] === \"Completed\") statusNr = 3; // Finished\n        else if(element['state'] === \"Active/Cancelled\") statusNr = 4; //canceled\n        else if(element['state'] === \"Queued\") statusNr = 5; //waiting\n        else if(element['state'] === \"Failed\") statusNr = 6; //Fehler\n       \n        console.log(\"SessionID vor dem verschicken\", s_id)\n\n        var obj = {\"status\": statusNr, \"session_id\":  s_id, \"task_id\": element[\"task_id\"]}; \n\n        console.log(\"PUT OBJ:\", obj);\n\n        axios.put('http://0.0.0.0:8080/updateOrderStatus', obj)\n        .then(res => {\n          if(res.data === undefined || res.data.length === 0)  return;\n        console.log(\"Response:\", res.data);\n        \n      \n        })\n        .catch(err => {\n            console.log(err.message); //Error-Handling\n            alert(\"Fehler beim Auftrag übermitteln.\");  \n      \n        })  \n        \n    });\n  });\n\n  } \n\n\n  //Check if old data = new data\n  function DataAreEqual(inputData, sortedOrders){\n    if(inputData.sort().join(',') === sortedOrders.sort().join(',')){\n      return true;\n      }\n      else return false;\n   }\n\n\n   function getSessionId(){\n\n    axios.get('http://0.0.0.0:8080/getSessionId')\n    .then(res => {\n    console.log(\"SessionId:\", res.data); //Data from Gateway\n\n    if(res.data.length === 0) { //Check if data is available\n     \n      return;\n    }\n    \n    return String(res.data)\n\n    })\n    .catch(err => {\n        console.log(err.message); //Error-Handling\n    })\n\n    }\n\n\n\n    return (\n        <div >\n         <TabChange/>\n        </div>\n    );\n\n}\n"]},"metadata":{},"sourceType":"module"}