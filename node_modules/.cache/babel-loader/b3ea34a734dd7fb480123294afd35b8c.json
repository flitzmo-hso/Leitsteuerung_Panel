{"ast":null,"code":"var _jsxFileName = \"/home/flitzmofinal/GitHub/Leitsteuerung_Panel/src/components/Orders/AutomaticOrders.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect } from \"react\";\nimport MUIDataTable from \"mui-datatables\";\nimport Button from '@material-ui/core/Button';\nimport axios from \"axios\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function ERPOrders() {\n  _s();\n\n  const columns = [{\n    name: \"O_ID\",\n    label: \"Order-Nr\",\n    options: {\n      filter: true,\n      sort: true,\n      display: true\n    }\n  }, {\n    name: \"OT_DESC\",\n    label: \"Order-Typ\",\n    options: {\n      filter: true,\n      sort: true,\n      display: true\n    }\n  }, {\n    name: \"O_TIMESTAMP\",\n    label: \"Zeit\",\n    options: {\n      filter: true,\n      sort: true,\n      display: true\n    }\n  }, {\n    name: \"O_PRIO\",\n    label: \"Priorität\",\n    options: {\n      filter: true,\n      sort: true,\n      display: true\n    }\n  }, {\n    name: \"O_WH_IDFROM\",\n    label: \"von Lagerplatz\",\n    options: {\n      filter: false,\n      sort: false,\n      display: false\n    }\n  }, {\n    name: \"O_WH_COORDINATEFROM\",\n    label: \"von Koordinate\",\n    options: {\n      filter: true,\n      sort: true,\n      display: true\n    }\n  }, {\n    name: \"O_WH_IDTO\",\n    label: \"nach Lagerplatz\",\n    options: {\n      options: {\n        filter: true,\n        sort: true,\n        display: false\n      }\n    }\n  }, {\n    name: \"O_WH_COORDINATETO\",\n    label: \"nach Koordinate\",\n    options: {\n      filter: true,\n      sort: true,\n      display: true\n    }\n  }, {\n    name: \"O_DP_DELIVERYPOINTFROM\",\n    label: \"Aufladepunkt\",\n    options: {\n      filter: true,\n      sort: true,\n      display: true\n    }\n  }, {\n    name: \"O_DP_DELIVERYPOINTTO\",\n    label: \"Abladepunkt\",\n    options: {\n      filter: true,\n      sort: true,\n      display: true\n    }\n  }, {\n    name: \"O_FT_IDREQUIREMENT\",\n    label: \"Benötiges Anbaugerät\",\n    options: {\n      filter: true,\n      sort: true,\n      display: true\n    }\n  }, {\n    name: \"O_OS_ID\",\n    label: \"Status ID\",\n    options: {\n      filter: false,\n      sort: false,\n      display: false\n    }\n  }, {\n    name: \"OS_DESC\",\n    label: \"Status\",\n    options: {\n      filter: true,\n      sort: true,\n      display: true\n    }\n  }];\n  const options = {\n    rowsPerPage: 5,\n    customToolbarSelect: () => {},\n    filterType: 'checkbox',\n    download: false,\n    onRowSelectionChange: (curRowSelected, allRowsSelected) => {\n      rowSelectEvent(curRowSelected, allRowsSelected);\n    }\n  };\n  const [allData, setAllData] = useState([]);\n  const [selectedData, setSelectedData] = useState([]);\n  var sessionId; //Event if data changed\n\n  useEffect(() => {\n    DatenLaden();\n  }); //Load data\n\n  function DatenLaden() {\n    if (sessionId === undefined) {\n      setSessionId();\n    }\n\n    axios.get('http://0.0.0.0:8080/getDBOrders?status=1&ordertype=1').then(res => {\n      console.log(\"RESPONSE:\", res); //Data from Gateway\n\n      if (res.data.length === 0) {\n        //Check if data is available\n        setAllData(undefined);\n        return;\n      }\n\n      if (DataAreEqual(allData, res.data)) return; //Check if data has changed    \n\n      console.log(\"Data:\", res.data);\n      setAllData(res.data); //Set new table data\n    }).catch(err => {\n      console.log(err.message); //Error-Handling\n    });\n  }\n\n  function setSessionId() {\n    axios.get('http://0.0.0.0:8080/getSessionId').then(res => {\n      console.log(\"SessionId:\", res.data); //Data from Gateway\n\n      if (res.data.length === 0) {\n        //Check if data is available\n        return;\n      }\n\n      sessionId = res.data;\n    }).catch(err => {\n      console.log(err.message); //Error-Handling\n    });\n  } //Check if old data = new data\n\n\n  function DataAreEqual(data, sortedOrders) {\n    if (data.sort().join(',') === sortedOrders.sort().join(',')) {\n      return true;\n    } else return false;\n  } //Submit selected Table Orders\n\n\n  function SubmitOrders() {\n    console.log(\"Ausgewählte Datensätze:\", selectedData);\n\n    if (selectedData === undefined || selectedData.length === 0) {\n      alert(\"Bitte Datensatz auswählen!\");\n      return;\n    }\n\n    console.log(\"Sumbit started:\", selectedData);\n    selectedData.forEach(element => {\n      var singleSubmits = filterSelectedData(element);\n      axios.post('http://0.0.0.0:8080/submit_task', singleSubmits).then(res => {\n        console.log(\"Insert data:\", \"taskid:\", res.data['task_id'], \"Order-Nr:\", element[\"O_ID\"], \"SessionId:\", sessionId);\n        if (res.data['task_id'] === undefined || element[\"O_ID\"] === undefined || sessionId === undefined) return;\n        insertMapping(res.data['task_id'], element[\"O_ID\"], sessionId);\n        cssMessage(\"Erfolgreich übermittelt.\", \"#4dff88\");\n      }).catch(err => {\n        console.log(err.message); //Error-Handling\n\n        cssMessage(\"Fehler beim Übermitteln.\", \"#9c2c2c\");\n      });\n    });\n    sleep(900).then(() => {\n      //Reload data\n      setSelectedData(undefined);\n      DatenLaden();\n      console.log(\"HOLA\"); //window.location.reload(); //TODO: Implement Reload for single tab \n    });\n  } //Sleep for asynchronous calls\n\n\n  function sleep(ms) {\n    return new Promise(resolve => setTimeout(resolve, ms));\n  } //Success and error messages\n\n\n  function cssMessage(message, color) {\n    //Set\n    document.getElementsByClassName(\"footer\")[0].style.textAlign = \"center\";\n    document.getElementsByClassName(\"footer\")[0].innerHTML = message;\n    document.getElementsByClassName(\"footer\")[0].style.backgroundColor = color; //Reset\n\n    sleep(4000).then(() => {\n      document.getElementsByClassName(\"footer\")[0].style.textAlign = \"right\";\n      document.getElementsByClassName(\"footer\")[0].innerHTML = \"Powered by ©Flitzmo\";\n      document.getElementsByClassName(\"footer\")[0].style.backgroundColor = \"#004466\";\n    });\n  }\n\n  function insertMapping(taskid, orderId, sessionId) {\n    console.log(\"TaskId:\", taskid, \"OrderId\", orderId, \"SessionId:\", sessionId);\n    var obj = {\n      \"OM_SESSIONID\": parseInt(sessionId),\n      \"OM_DELIVERYID\": taskid,\n      \"OM_O_ID\": parseInt(orderId),\n      \"OM_OT_ID\": 1\n    };\n    axios.post('http://0.0.0.0:8080/insertMapping', obj).then(res => {\n      cssMessage(\"Erfolgreich übermittelt.\", \"#4dff88\");\n    }).catch(err => {\n      console.log(err.message); //Error-Handling\n\n      cssMessage(\"Fehler beim Übermitteln.\", \"#9c2c2c\");\n    });\n  }\n\n  function filterSelectedData(element) {\n    //Delivery Order \n    console.log(element);\n    if (element[\"O_DP_DELIVERYPOINTTO\"] === '' || element[\"O_DP_DELIVERYPOINTFROM\"] === '' || element[\"O_WH_COORDINATETO\"] === '' || element[\"O_WH_COORDINATEFROM\"] === '') return undefined;\n    var obj = {\n      \"task_type\": \"Delivery\",\n      \"start_time\": 0,\n      \"priority\": 0,\n      \"description\": {\n        \"dropoff_ingestor\": element[\"O_DP_DELIVERYPOINTTO\"],\n        \"dropoff_place_name\": element[\"O_WH_COORDINATETO\"],\n        \"pickup_dispenser\": element[\"O_DP_DELIVERYPOINTFROM\"],\n        \"pickup_place_name\": element[\"O_WH_COORDINATEFROM\"]\n      }\n    };\n    console.log(\"Filtered Obj:\", obj); //Loop Order\n\n    /*if (element[\"task_type\"] === \"Loop\") {\n       if(element[\"start_time\"] === '' || element[\"priority\"]  === '' || element[\"num_loops\"]  === ''  || \n      element[\"num_loops\"]  === 0 ||  element[\"start_name\"]  === '' ||  element[\"finish_name\"]  ===  '')  return undefined; \n       obj['task_type'] = \"Loop\"; obj['start_time'] = parseInt(element[\"start_time\"]); \n      obj['priority'] = parseInt(element[\"priority\"]); \n      obj['description'] = {\"num_loops\": parseInt(element[\"num_loops\"]) , \"start_name\": element[\"start_name\"], \"finish_name\": element[\"finish_name\"]};\n    \n    }*/\n\n    return obj;\n  } //RowSelectEvent\n\n\n  function rowSelectEvent(curRowSelected, allRowsSelected) {\n    var _selectedData = [];\n\n    if (allRowsSelected.length === 0) {\n      //Wenn keine Rows ausgewählt sind\n      setSelectedData(undefined);\n      return;\n    }\n\n    allRowsSelected.forEach(element => {\n      //Get selected orders\n      _selectedData.push(allData[element.dataIndex]);\n    });\n    setSelectedData(_selectedData);\n    return;\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    align: \"left\",\n    children: [/*#__PURE__*/_jsxDEV(MUIDataTable, {\n      title: \"Transportaufträge\",\n      data: allData,\n      columns: columns,\n      options: options\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 228,\n      columnNumber: 5\n    }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 233,\n      columnNumber: 5\n    }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 234,\n      columnNumber: 5\n    }, this), /*#__PURE__*/_jsxDEV(Button, {\n      style: {\n        backgroundColor: \"#e68a00\",\n        color: \"white\"\n      },\n      variant: \"contained\",\n      onClick: SubmitOrders,\n      title: \"Mit Klick auf diesen Button werden alle ausgew\\xE4hlten Transportauftr\\xE4ge \\xFCbermittelt.\",\n      children: \"Absenden\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 235,\n      columnNumber: 5\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 226,\n    columnNumber: 3\n  }, this);\n}\n\n_s(ERPOrders, \"llTBpHV7Y5cZtkKg3BL5C+Lz1U8=\");\n\n_c = ERPOrders;\n\nvar _c;\n\n$RefreshReg$(_c, \"ERPOrders\");","map":{"version":3,"sources":["/home/flitzmofinal/GitHub/Leitsteuerung_Panel/src/components/Orders/AutomaticOrders.js"],"names":["React","useState","useEffect","MUIDataTable","Button","axios","ERPOrders","columns","name","label","options","filter","sort","display","rowsPerPage","customToolbarSelect","filterType","download","onRowSelectionChange","curRowSelected","allRowsSelected","rowSelectEvent","allData","setAllData","selectedData","setSelectedData","sessionId","DatenLaden","undefined","setSessionId","get","then","res","console","log","data","length","DataAreEqual","catch","err","message","sortedOrders","join","SubmitOrders","alert","forEach","element","singleSubmits","filterSelectedData","post","insertMapping","cssMessage","sleep","ms","Promise","resolve","setTimeout","color","document","getElementsByClassName","style","textAlign","innerHTML","backgroundColor","taskid","orderId","obj","parseInt","_selectedData","push","dataIndex"],"mappings":"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","sourcesContent":["import React, { useState, useEffect} from \"react\";\nimport MUIDataTable from \"mui-datatables\";\nimport Button from '@material-ui/core/Button';\nimport axios from \"axios\";\n\nexport default function ERPOrders() {\n\n  const columns = [ \n   {name: \"O_ID\", label: \"Order-Nr\", options: {filter: true, sort: true, display: true}}, \n   {name: \"OT_DESC\", label: \"Order-Typ\", options: {filter: true, sort: true, display: true}}, \n   {name: \"O_TIMESTAMP\", label: \"Zeit\", options: {filter: true, sort: true, display: true}},\n   {name: \"O_PRIO\", label: \"Priorität\",  options: {filter: true,  sort: true, display: true}}, \n   {name: \"O_WH_IDFROM\", label: \"von Lagerplatz\", options: {filter: false, sort: false, display: false}},\n   {name: \"O_WH_COORDINATEFROM\", label: \"von Koordinate\", options: {filter: true, sort: true, display: true}}, \n   {name: \"O_WH_IDTO\", label: \"nach Lagerplatz\", options: {options: {filter: true, sort: true, display: false}}}, \n   {name: \"O_WH_COORDINATETO\", label: \"nach Koordinate\", options: {filter: true, sort: true, display: true}}, \n   {name: \"O_DP_DELIVERYPOINTFROM\", label: \"Aufladepunkt\", options: {filter: true, sort: true, display: true}}, \n   {name: \"O_DP_DELIVERYPOINTTO\", label: \"Abladepunkt\", options: {filter: true, sort: true, display: true}}, \n   {name: \"O_FT_IDREQUIREMENT\", label: \"Benötiges Anbaugerät\", options: {filter: true, sort: true, display: true}},\n   {name: \"O_OS_ID\", label: \"Status ID\",options: {filter: false, sort: false,display: false}},\n   {name: \"OS_DESC\", label: \"Status\",options: {filter: true,sort: true,display: true}} \n   ];\n\n  const options = {rowsPerPage: 5, customToolbarSelect: () => { }, filterType: 'checkbox', download: false, \n   onRowSelectionChange : (curRowSelected, allRowsSelected) => {rowSelectEvent(curRowSelected, allRowsSelected); }};\n  \n  const [allData, setAllData] = useState([]); \n  const [selectedData, setSelectedData] =  useState([]); \n  var sessionId;\n\n  //Event if data changed\n  useEffect(() => { DatenLaden(); });\n  \n  //Load data\n  function DatenLaden(){\n\n    if (sessionId  === undefined ){ setSessionId() } \n\n    axios.get('http://0.0.0.0:8080/getDBOrders?status=1&ordertype=1')\n    .then(res => {\n    console.log(\"RESPONSE:\", res); //Data from Gateway\n\n    if(res.data.length === 0) { //Check if data is available\n      setAllData(undefined);\n      return;\n    }\n\n    if (DataAreEqual(allData, res.data)) return; //Check if data has changed    \n    console.log(\"Data:\", res.data);    \n    setAllData(res.data); //Set new table data\n\n    })\n    .catch(err => {\n        console.log(err.message); //Error-Handling\n    })\n\n  }\n\n  function setSessionId(){\n\n    axios.get('http://0.0.0.0:8080/getSessionId')\n    .then(res => {\n    console.log(\"SessionId:\", res.data); //Data from Gateway\n\n    if(res.data.length === 0) { //Check if data is available\n    \n      return;\n    }\n    \n    sessionId = res.data;\n\n    })\n    .catch(err => {\n        console.log(err.message); //Error-Handling\n    })\n\n}\n\n  //Check if old data = new data\n  function DataAreEqual(data, sortedOrders){\n    if(data.sort().join(',') === sortedOrders.sort().join(',')){\n      return true;\n      }\n      else return false;\n    }\n\n  //Submit selected Table Orders\n  function SubmitOrders() {\n\n    console.log(\"Ausgewählte Datensätze:\", selectedData);\n\n    if(selectedData === undefined || selectedData.length === 0) {\n      alert(\"Bitte Datensatz auswählen!\"); return; \n    }    \n    \n    console.log(\"Sumbit started:\", selectedData);\n\n    selectedData.forEach(element => {\n\n  \n      var singleSubmits = filterSelectedData(element);\n\n      axios.post('http://0.0.0.0:8080/submit_task', singleSubmits)\n      .then(res => {\n\n     \n      console.log(\"Insert data:\", \"taskid:\",  res.data['task_id'], \"Order-Nr:\", element[\"O_ID\"], \"SessionId:\", sessionId)\n      if(res.data['task_id'] === undefined || element[\"O_ID\"] === undefined || sessionId === undefined) return;\n\n      insertMapping(res.data['task_id'], element[\"O_ID\"], sessionId);\n      cssMessage(\"Erfolgreich übermittelt.\", \"#4dff88\"); \n    \n      })\n      .catch(err => {\n          console.log(err.message); //Error-Handling\n          cssMessage(\"Fehler beim Übermitteln.\", \"#9c2c2c\");     \n        \n      }) \n      \n    });\n\n   sleep(900).then(() => { \n    //Reload data\n    setSelectedData(undefined); \n    DatenLaden(); \n\n    console.log(\"HOLA\");\n\n    //window.location.reload(); //TODO: Implement Reload for single tab \n\n    }); \n\n    }\n\n    //Sleep for asynchronous calls\n    function sleep(ms) {\n      return new Promise(resolve => setTimeout(resolve, ms));\n    }\n\n\n        //Success and error messages\n    function cssMessage(message, color)\n    { //Set\n      document.getElementsByClassName(\"footer\")[0].style.textAlign = \"center\";\n      document.getElementsByClassName(\"footer\")[0].innerHTML = message;\n      document.getElementsByClassName(\"footer\")[0].style.backgroundColor = color;\n\n      //Reset\n      sleep(4000).then(() => { \n      document.getElementsByClassName(\"footer\")[0].style.textAlign = \"right\";\n      document.getElementsByClassName(\"footer\")[0].innerHTML = \"Powered by ©Flitzmo\";\n      document.getElementsByClassName(\"footer\")[0].style.backgroundColor = \"#004466\";\n      });\n    }\n\n    function insertMapping(taskid, orderId, sessionId) {\n\n      console.log(\"TaskId:\", taskid, \"OrderId\", orderId, \"SessionId:\", sessionId)\n      \n      var obj = { \"OM_SESSIONID\": parseInt(sessionId), \"OM_DELIVERYID\": taskid, \"OM_O_ID\": parseInt(orderId), \"OM_OT_ID\":  1};\n  \n      axios.post('http://0.0.0.0:8080/insertMapping', obj)\n      .then(res => {\n  \n        cssMessage(\"Erfolgreich übermittelt.\", \"#4dff88\");\n    \n      })\n      .catch(err => {\n          console.log(err.message); //Error-Handling\n          cssMessage(\"Fehler beim Übermitteln.\", \"#9c2c2c\"); \n    \n      }) \n  \n    } \n\n\n    function filterSelectedData(element){\n \n      //Delivery Order \n      console.log(element);\n\n        if (element[\"O_DP_DELIVERYPOINTTO\"] === '' || element[\"O_DP_DELIVERYPOINTFROM\"]  === '' || element[\"O_WH_COORDINATETO\"] === '' || element[\"O_WH_COORDINATEFROM\"] === '')  return undefined;\n\n        var obj = {\"task_type\": \"Delivery\", \"start_time\": 0, \"priority\": 0,\n            \"description\": {\"dropoff_ingestor\": element[\"O_DP_DELIVERYPOINTTO\"], \"dropoff_place_name\": element[\"O_WH_COORDINATETO\"],\n            \"pickup_dispenser\": element[\"O_DP_DELIVERYPOINTFROM\"], \"pickup_place_name\": element[\"O_WH_COORDINATEFROM\"] }};\n\n        console.log(\"Filtered Obj:\", obj);\n\n\n      //Loop Order\n      /*if (element[\"task_type\"] === \"Loop\") {\n\n        if(element[\"start_time\"] === '' || element[\"priority\"]  === '' || element[\"num_loops\"]  === ''  || \n        element[\"num_loops\"]  === 0 ||  element[\"start_name\"]  === '' ||  element[\"finish_name\"]  ===  '')  return undefined; \n\n        obj['task_type'] = \"Loop\"; obj['start_time'] = parseInt(element[\"start_time\"]); \n        obj['priority'] = parseInt(element[\"priority\"]); \n        obj['description'] = {\"num_loops\": parseInt(element[\"num_loops\"]) , \"start_name\": element[\"start_name\"], \"finish_name\": element[\"finish_name\"]};\n      \n    }*/\n\n    return obj;\n    }\n\n//RowSelectEvent\nfunction rowSelectEvent(curRowSelected, allRowsSelected){ \n\n  var _selectedData = [];\n\n  if(allRowsSelected.length === 0) {  //Wenn keine Rows ausgewählt sind\n    setSelectedData(undefined);\n    return;\n  }\n  \n  allRowsSelected.forEach(element => { //Get selected orders\n    _selectedData.push(allData[element.dataIndex])\n  });\n\n  setSelectedData(_selectedData);\n\n  return;\n}\n\n  return (\n  <div align=\"left\">\n    \n    <MUIDataTable \n        title={\"Transportaufträge\"}\n        data={allData}      \n        columns={columns}\n        options={options}/>\n    <br/>\n    <br/>\n    <Button style={{backgroundColor: \"#e68a00\", color:\"white\"}}\n    variant=\"contained\" \n    onClick={SubmitOrders} \n    title=\"Mit Klick auf diesen Button werden alle ausgewählten Transportaufträge übermittelt.\">\n       Absenden\n    </Button>\n   \n    </div>\n  );\n}"]},"metadata":{},"sourceType":"module"}